<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
          crossorigin="anonymous"></script>

  <title>íšŒì›ê°€ì…</title>

  <style>
    .join {
      position: absolute;
      left: 50%;
      top: 5%;
      transform: translate(-50%, -50%);
    }

    .information {
      position: absolute;
      left: 50%;
      top: 18%;
      transform: translate(-50%, -50%);

      width: 500px;
      height: 100px;
    }

    .check {
      position: absolute;
      left: 40%;
      top: 58%;
      transform: translate(-50%, -50%);
    }

    .check2 {
      position: absolute;
      left: 48%;
      top: 58%;
      transform: translate(-50%, -50%);
    }

    .checkbox input {
      display: none;
    }

    .checkbox_icon {
      display: inline-block;
      width: 20px;
      height: 20px;
      background-color: transparent;
      border: 1px solid red;
      position: relative;
      cursor: pointer;
    }

    .checkbox_icon::before, .checkbox_icon::after {
      content: '';
      display: inline-block;
      width: 1px;
      height: 0;
      background-color: black;
      position: absolute;
      transform-origin: left top;
    }

    .checkbox_icon::before {
      top: 9px;
      left: 2px;
      transform: rotate(-45deg);
    }

    .checkbox_icon::after {
      top: 16px;
      left: 9px;
      transform: rotate(-135deg);
    }

    .checkbox input:checked + .checkbox_icon {
      border-color: red;
    }

    .checkbox input:checked + .checkbox_icon::before {
      height: 10px;
      transition: all 0.15s ease;

    }

    .checkbox input:checked + .checkbox_icon::after {
      height: 20px;
      transition: all 0.15s ease 0.15s;
    }

    .yn {
      position: absolute;
      left: 43%;
      top: 54%;
      transform: translate(-50%, -50%);
    }

    .yes {
      position: absolute;
      left: 38%;
      top: 58%;
      transform: translate(-50%, -50%);
    }

    .no {
      position: absolute;
      left: 45%;
      top: 58%;
      transform: translate(-50%, -50%);
    }

    .btn-default {
      position: absolute;
      left: 55%;
      top: 57%;
      transform: translate(-50%, -50%);

      border-width: medium;
      border-color: black;
    }

    .tutor_info {
      position: absolute;
      left: 50%;
      top: 68%;
      transform: translate(-50%, -50%);

      width: 500px;
      height: 100px;
    }

    .finish {
      position: absolute;
      left: 96%;
      top: 5%;
      transform: translate(-50%, -50%);

      background-color: blue;
      border-width: medium;
      border-color: black;
      border-radius: 15px;
      color: white;

      width: 100px;
      height: 60px;
    }

    .id_check {
      position: absolute;
      left: 66%;
      top: 31%;
      transform: translate(-50%, -50%);

      width: 80px;
      height: 55px;
    }

    .pw_check {
      position: absolute;
      left: 66%;
      top: 39%;
      transform: translate(-50%, -50%);

      width: 80px;
      height: 55px;
    }

    .back {
      position: absolute;
      left: 3%;
      top: 4.5%;
      transform: translate(-50%, -50%);

      width: 80px;
      height: 55px;
    }

    .container {
      background-color: transparent;
      background-size: auto;

      width: 800px;
      height: 180px;

      position: absolute;
      left: 50%;
      top: 85%;
      transform: translate(-50%, -50%);

      display: flex;
      flex-direction: column;
    }

    .image-upload {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .button {
      display: flex;
      justify-content: center;
    }

    label {
      cursor: pointer;
      font-size: 1em;
    }

    #chooseFile {
      visibility: hidden;
    }

    .fileContainer {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .fileInput {
      display: flex;
      align-items: center;
      border-bottom: solid 2px black;
      width: 60%;
      height: 30px;
    }

    #fileName {
      margin-left: 5px;
    }

    .image-show {
      z-index: -1;
      display: flex;
      justify-content: center;
      align-items: center;
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .prev {
      position: absolute;
      left: 50%;
      top: 200%;
      transform: translate(-50%, -50%);

      width: 300px;
      height: 300px;
    }

    .col-md-4{
      position: absolute;
      left: 50%;
      top: 137%;
      transform: translate(-50%, -50%);
    }

    .trash{
      background-color: transparent;

      position: absolute;
      left: 50%;
      top: 160%;
      transform: translate(-50%, -50%);

      width: 250px;
      height: 250px;
    }

  </style>

  <script>
    function clickCheck(target) {
      document.querySelectorAll(`input[type=checkbox]`)
              .forEach(el => el.checked = false);

      target.checked = true;
    }

    let select = 0 // ê°•ì‚¬ì¸ì§€ ì¼ë°˜íšŒì›ì¸ì§€ íŒë³„

    function choice() {

      var obj_length = document.getElementsByName("checking").length;

      for (var i = 0; i < obj_length; i++) {
        if (document.getElementsByName("checking")[i].checked == true) {
          alert(document.getElementsByName("checking")[i].value);
          select = i
        }
      }
      if(select === 0){
        $('.tutor_box').show()
      } else {
        $('.tutor_box').hide()
      }
    }

    function loadFile(input) {
      var file = input.files[0];

      var name = document.getElementById('fileName');
      name.textContent = file.name;

      var newImage = document.createElement("img");
      newImage.setAttribute("class", 'img');

      newImage.src = URL.createObjectURL(file);

      newImage.style.width = "70%";
      newImage.style.height = "70%";
      newImage.style.visibility = "hidden";   //ë²„íŠ¼ì„ ëˆ„ë¥´ê¸° ì „ê¹Œì§€ëŠ” ì´ë¯¸ì§€ ìˆ¨ê¸°ê¸°
      newImage.style.objectFit = "contain";

      var container = document.getElementById('image-show');
      container.appendChild(newImage);

      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById('preview').src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
      } else {
        document.getElementById('preview').src = "";
      }
    };
    //--------------------------------------------------------

    function overlap() {
      let id = $('#new_id').val()
      let idck = 0;

      $.ajax({
        type: 'GET',
        url: '/api/id_check',
        data: {},
        success: function (response) {
          let rows = response['id_lists']

          if (id === ''){
            alert("ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
            return false
          }

          for (let i = 0; i < rows.length; i++) {
            if (rows[i]['new_id'] === id) {
              idck = 1
              break
            } else {
              idck = 0
            }
          }
          if (idck === 1){
            alert("ì¤‘ë³µëœ ì•„ì´ë”” ì…ë‹ˆë‹¤.")
          } else {
            alert("ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë”” ì…ë‹ˆë‹¤.")
          }
        }
      })
    }
    //--------------------------------------------------------
    function pw_check() {
      var pw = $("#new_pw").val();
      var num = pw.search(/[0-9]/g);
      var eng = pw.search(/[a-z]/ig);
      var spe = pw.search(/[`~!@@#$%^&*|â‚©â‚©â‚©'â‚©";:â‚©/?]/gi);

      if (pw.length < 8 || pw.length > 20) {
        alert("ë¹„ë°€ë²ˆí˜¸ëŠ” 8ìë¦¬ ~ 20ìë¦¬ ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return false;
      } else if (pw.search(/\s/) != -1) {
        alert("ë¹„ë°€ë²ˆí˜¸ëŠ” ê³µë°± ì—†ì´ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return false;
      } else if (num < 0 || eng < 0 || spe < 0) {
        alert("ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸,ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í˜¼í•©í•˜ì—¬ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return false;
      } else if ($('#new_pw').val() !== $('#double_pw').val()) {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")
        return false
      } else {
        alert("í†µê³¼");
        return true;
      }
    }

    //-------------------------------------------------------
    function save_info() { //í˜œë¯¼ë‹˜ ì´ í•¨ìˆ˜ ë¶€ë¶„ë§Œ ë³´ì‹œë©´ ë  ê²ƒ ê°™ì•„ìš”
      let new_id = $('#new_id').val()
      if (new_id === ''){
        alert("ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
        return false
      }

      let new_pw = $('#new_pw').val()
      if (pw_check() === false){
        alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”.")
        return false
      }

      let name = $('#name').val()
      if (name === ''){
        alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.")
        return false
      }

      let location = $('#location').val()
      if (location === ''){
        alert("ì§€ì—­ì„ ì…ë ¥í•˜ì„¸ìš”.")
        return false
      }
      let choice = select

      let qualification = $('#qualification').val()
      let career = $('#career').val()

      if (select === 0) {
        if (qualification === '') {
          alert("ìê²©ì¦ì„ ì…ë ¥í•˜ì„¸ìš”.")
          return false
        }

        if (career === '') {
          alert("ê²½ë ¥ì„ ì…ë ¥í•˜ì„¸ìš”.")
          return false
        }
      }

      let img = $('#chooseFile').val()
      let type = $('#inputState option:selected').val()

      $.ajax({
        type: 'POST',
        url: '/api/save',
        enctype: 'multipart/form-data',
        data: {
          name_give: name, new_id_give: new_id, new_pw_give: new_pw,
          location_give: location, choice_give: choice, qualification_give: qualification,
          career_give: career, img_give: img, type_give: type
        },
        success: function (response) {
          alert(response['msg'])
          window.location.reload()
          window.location.href = '/'
        }
      })
    }

  </script>

</head>
<body>
<h1 class="join">íšŒì›ê°€ì…</h1>
<div class="information">
  <div class="form-floating mb-3">
    <input id="name" type="email" class="form-control" placeholder=" ">
    <label>ì´ë¦„</label>
  </div>
  <div class="form-floating mb-3">
    <input name="username" id="new_id" type="email" class="form-control" placeholder=" ">
    <label>ID</label>
  </div>
  <div class="form-floating mb-3">
    <input id="new_pw" type="password" class="form-control" placeholder=" ">
    <label>PW</label>
  </div>
  <div class="form-floating mb-3">
    <input id="double_pw" type="password" class="form-control" placeholder=" ">
    <label>PW í™•ì¸</label>
  </div>
  <div class="form-floating mb-3">
    <input id="location" type="email" class="form-control" placeholder=" ">
    <label>ì§€ì—­</label>
  </div>
</div>
<div class="check">
  <label class="checkbox">
    <input type="checkbox" name="checking" value="ë‚˜ë¨¸ì§€ ë¹ˆì¹¸ ì±„ì›Œì£¼ì„¸ìš”!!" id="tutor_box" onclick="clickCheck(this)">
    <span class="checkbox_icon"></span>
    <span class="checkbox_text"></span>
  </label>
</div>
<div class="check2">
  <label class="checkbox">
    <input type="checkbox" name="checking" value="ì™„ë£Œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!!" id="member_box" onclick="clickCheck(this)">
    <span class="checkbox_icon"></span>
    <span class="checkbox_text"></span>
  </label>
</div>
<p class="yn">ì²´í¬í•´ì£¼ì„¸ìš”</p>
<p class="yes">ê°•ì‚¬</p>
<p class="no">ì¼ë°˜íšŒì›</p>
<button onclick="choice()" class="btn btn-default" type="submit">í™•ì¸</button>
<div class="tutor_box" style="display: none">
  <div class="tutor_info">
    <div class="form-floating mb-3">
      <input id="qualification" type="email" class="form-control" placeholder=" ">
      <label>ìê²©ì¦</label>
    </div>
    <div class="form-floating mb-3">
      <input id="career" type="email" class="form-control" placeholder=" ">
      <label>ê²½ë ¥</label>
    </div>
  </div>
  <!--ì´ë¯¸ì§€ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°-->
  <div class="container">
    <div class="image-upload" id="image-upload">

      <form method="post" enctype="multipart/form-data">
        <div class="button">
          <label for="chooseFile">
            ğŸ‘‰ ì‚¬ì§„ ì œì¶œ! <--í´ë¦­ ğŸ‘ˆ
          </label>
        </div>
        <input type="file" id="chooseFile" name="chooseFile" accept="image/*" onchange="loadFile(this)">
        <img class="prev" id="preview"/>
      </form>

      <div class="fileContainer">
        <div class="fileInput">
          <p>íŒŒì¼ëª…: </p>
          <p id="fileName"></p>
        </div>
      </div>
    </div>

    <div class="image-show" id="image-show"></div>
  </div>
  <!---------------------->
  <div class="col-md-4">
    <label for="inputState" class="form-label">ê°•ì‚¬ì¢…ë¥˜</label>
    <select id="inputState" class="form-select" onchange="">
      <option value="pt">PT ê°•ì‚¬</option>
      <option value="yoga">ìš”ê°€ê°•ì‚¬</option>
      <option value="filates">í•„ë¼í…ŒìŠ¤ê°•ì‚¬</option>
      <option value="rhb">ì¬í™œì¹˜ë£Œì‚¬</option>
      <option value="etc">ê¸°íƒ€</option>
    </select>
  </div>
</div>
<div onclick="save_info()">
  <button class="finish" type="submit">ì™„ë£Œ</button>
</div>

<button class="id_check" type="submit" onclick="overlap()">ì¤‘ë³µí™•ì¸</button>
<img id="id_check_sucess" style="display: none;">

<button class="pw_check" type="submit" onclick="pw_check()">ê²€ì‚¬</button>
<button onclick="window.location.href='/'" class="back" type="submit">ë’¤ë¡œê°€ê¸°</button>
</div>

<div class="trash"></div>

</body>
</html>